{"remainingRequest":"/home/nicolas/Desktop/socket_io/client/node_modules/vue-loader-v16/dist/index.js??ref--0-1!/home/nicolas/Desktop/socket_io/client/src/components/ComponentCanvas.vue?vue&type=template&id=7425f435","dependencies":[{"path":"/home/nicolas/Desktop/socket_io/client/src/components/ComponentCanvas.vue","mtime":1616607226764},{"path":"/home/nicolas/Desktop/socket_io/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/nicolas/Desktop/socket_io/client/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/nicolas/Desktop/socket_io/client/node_modules/vue-loader-v16/dist/templateLoader.js","mtime":499162500000},{"path":"/home/nicolas/Desktop/socket_io/client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/nicolas/Desktop/socket_io/client/node_modules/vue-loader-v16/dist/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CiAgICA8Y2FudmFzIHdpZHRoPSIzMDAiIGhlaWdodD0iMzAwIj4KICAgICAgICBDYW52YXMgbm90IHN1cHBvcnRlZAogICAgPC9jYW52YXM+Cg=="},{"version":3,"sources":["/home/nicolas/Desktop/socket_io/client/src/components/ComponentCanvas.vue"],"names":[],"mappings":";IACI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAC5B,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACvB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC","file":"/home/nicolas/Desktop/socket_io/client/src/components/ComponentCanvas.vue","sourceRoot":"","sourcesContent":["<template>\n    <canvas width=\"300\" height=\"300\">\n        Canvas not supported\n    </canvas>\n</template>\n\n<script>\n    import io from \"socket.io-client\"\n\n    export default {\n        name: 'ComponentCanvas',\n        data (){\n            return {\n                socket: {},\n                player: {},\n                enemy:  {},\n                turn: 0,\n            }\n        },\n        created() {\n            this.socket = io(\"http://localhost:3000\", {transports:['websocket']});\n        },\n        mounted() {\n\n            this.socket.on(\"update\", data => {\n                this.player = data.player;\n                this.enemy = data.enemy;\n                this.turn = data.globalTurns;\n            });\n\n            class Entity\n            {\n                constructor(playerId, x, y, width, height, sprite, cam)\n                {\n                    this.playerId = playerId;\n                    this.x = x;\n                    this.y = y;\n                    this.width = width;\n                    this.height = height;\n                    this.sprite = sprite\n                    this.cam = {\n                        x: cam.x,\n                        y: cam.y\n                    }\n                }\n            }\n\n\n\n            class EntityListDict\n            {\n                constructor()\n                {\n                    this.entities = {\n                        players: {}\n                    }\n                }\n\n                add(entity)\n                {\n                    this.entities.players[entity.playerId] = entity;\n                }\n\n                remove(entityId)\n                {\n                    delete this.entities.players[entityId];\n                }\n\n\n                enitityExistis(entity)\n                {\n                    if (entity.playerId in this.entities.players)\n                    {\n                        return true;\n                    }\n\n                    return false;\n                }\n\n                print()\n                {\n                    console.log(this.entities.players)\n                }\n            }\n\n            this.socket.on('connect', () => {\n                const playerId = this.socket.id\n                console.log(\"> Connected to Server: \", playerId);\n\n                var canvas = document.querySelector('canvas');\n                var context = canvas.getContext('2d');\n\n                var entityList = new EntityListDict();\n\n                entityList.print()\n\n                // var background = new Image();\n                // background.src = require('../assets/map.png');\n\n\n                // var game_world  = new Entity(null, 0, 0, 595, 595, background, {x:0, y:0});\n\n\n                var cam = {\n                    x: 0,\n                    y: 0,\n                    width: canvas.width,\n                    height: canvas.height,\n                    left_edge: function() {\n                        return this.x + (this.width * 0.25);   \n                    },\n                    right_edge: function() {\n                        return this.x + (this.width * 0.75);   \n                    },\n                    top_edge: function() {\n                        return this.y + (this.height * 0.25);   \n                    },\n                    bot_edge: function() {\n                        return this.y + (this.height * 0.75);   \n                    }\n                }\n\n\n                // sprite\n                // entityList.add(game_world)\n\n                var that = this\n                window.addEventListener('keydown', function(e){\n                    var keyPressed = e.key;\n\n                    const command = {\n                        type: 'move-player',\n                        playerId: playerId,\n                        keyPressed\n                    }\n\n                    that.socket.emit('move-player', command);\n\n                }, false);\n\n    \n\n                function loop(){\n                    window.requestAnimationFrame(loop, canvas);\n                    render();\n                }\n\n                this.socket.on('setup', (command) => {\n                        \n                    var sprite_char = new Image();\n                    sprite_char.src = require('../assets/idle.png');\n\n                    var background = new Image()\n                    background.src = require('../assets/map.png');\n\n                    var game_world  = new Entity(null, 0, 0, command.scenario.image.width, command.scenario.image.height, background, {x:0, y:0});\n                    entityList.add(game_world)\n\n                    Object.keys(command.players).forEach(function(key) {\n                        entityList.add(new Entity(key, command.state.players[key].x, command.state.players[key].y, 16, 16, sprite_char, command.state.players[key].cam))\n                    });\n                })\n\n\n                this.socket.on('move-player', (command) => {\n                    console.log(command)\n                    updateSpecificPlayer(command.playerId, command.position, command.cam)\n                });\n\n\n                this.socket.on('add-player', (command) => {\n                    entityList.add(new Entity(command.playerId, command.position.x, command.position.y, 16, 16, sprite_char, command.cam))\n                });\n\n                this.socket.on('remove-player', (command) => {\n                    console.log(\"> Removing Player \", command.playerId);\n                    entityList.remove(command.playerId)\n                });\n\n\n                function updateSpecificPlayer(playerId, position, cam){\n                    entityList.entities.players[playerId].x = position.x;\n                    entityList.entities.players[playerId].y = position.y;\n\n                    entityList.entities.players[playerId].cam.x = cam.x;\n                    entityList.entities.players[playerId].cam.y = cam.y;\n                }\n\n\n\n                function render()\n                {\n                    context.save();\n\n                    var playerCam = entityList.entities.players[playerId].cam;\n                    context.translate(-playerCam.x, -playerCam.y);\n\n                    for (const [key, value] of Object.entries(entityList.entities.players)) {\n                        context.drawImage(value.sprite, 0, 0, value.width, value.height, value.x, value.y, value.width, value.height);   \n                    }\n\n                    context.restore();\n                }\n\n                loop()\n            });\n\n\n\n\n        }\n\n    }\n</script>\n\n<style scoped></style>\n"]}]}